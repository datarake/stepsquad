services:
  api:
    build: ./apps/api
    ports:
      - "8004:8080"
    environment:
      COMP_TZ: Europe/Bucharest
      GRACE_DAYS: "2"
      GCP_ENABLED: "true"
      GOOGLE_CLOUD_PROJECT: ${GOOGLE_CLOUD_PROJECT:-stepsquad-46d14}
      PORT: "8080"
    volumes:
      - ${HOME}/.config/gcloud:/root/.config/gcloud:ro
  web:
    build:
      context: ./apps/web
      args:
        VITE_API_BASE_URL: "http://localhost:8004"
        VITE_USE_DEV_AUTH: "false"
        VITE_FIREBASE_API_KEY: ${VITE_FIREBASE_API_KEY:-AIzaSyBAPgF7xzHOqKgGG8HkWgArtM4Luc_au1M}
        VITE_FIREBASE_AUTH_DOMAIN: ${VITE_FIREBASE_AUTH_DOMAIN:-stepsquad-46d14.firebaseapp.com}
        VITE_FIREBASE_PROJECT_ID: ${VITE_FIREBASE_PROJECT_ID:-stepsquad-46d14}
        VITE_FIREBASE_STORAGE_BUCKET: ${VITE_FIREBASE_STORAGE_BUCKET:-stepsquad-46d14.firebasestorage.app}
        VITE_FIREBASE_MESSAGING_SENDER_ID: ${VITE_FIREBASE_MESSAGING_SENDER_ID:-451432804996}
        VITE_FIREBASE_APP_ID: ${VITE_FIREBASE_APP_ID:-1:451432804996:web:72718bbe41e597a69008d1}
    ports:
      - "5173:8080"
    depends_on:
      - api
  workers:
    build: ./apps/workers
    environment:
      GCP_ENABLED: "false"
      GOOGLE_CLOUD_PROJECT: StepSquad
      BQ_DATASET: stepsquad
      PUBSUB_SUB_INGEST: steps.ingest.sub
      PORT: "8080"  # optional, for consistency
    depends_on:
      - api
  tekolin-website:
    build: ./apps/tekolin-website
    ports:
      - "5174:8080"
